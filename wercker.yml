box: kimesawa/sbt_pip_npm
ready:
    steps:
        - script:
            name: ready
            code: echo "ready"
sbt-build:
    steps:
        - script:
            name: pip install
            code: pip install -r requirements.txt
        - script:
            name: npm install
            code: npm install
        - script:
            name: sbt test compile
            code: cat /dev/null | sbt test:compile
        - script:
            name: sbt test
            code: cat /dev/null | sbt test:test
        - script:
            name: sbt build
            code: sbt assembly
deploy-ansible:
    steps:
        - script:
            name: pip install
            code: pip install -r ansible/requirements.txt
        - add-ssh-key:
            keyname: SSH_KEY
            host: $WEBSERVER_IP_ADDRESS
        - add-to-known_hosts:
            hostname: $WEBSERVER_IP_ADDRESS
            fingerprint: $FINGERPRINT
            type: rsa
            local: true
            port: $SSH_PORT
        - script:
            name: ansible
            code: ansible-playbook ansible/roles/setup_CentOS7.yml -i ansible/hosts -vv
    after-steps:
    #    - internal/docker-push:
    #        username: $DOCKER_HUB_USERNAME
    #        password: $DOCKER_HUB_PASSWORD
    #        tag: debug
    #        repository: kimesawa/result
          - theollyr/slack-notifier@1.3.1:
             url: $SLACK_URL
             channel: "#ci-cms"
             username: "木目沢 康廣"
             branch: master
             passed_msg: "ビルド成功時のメッセージ"
             failed_msg: "ビルド失敗時のメッセージ"